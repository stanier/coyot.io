var app=angular.module("coyot.io",[]);app.controller("ClusterManagementCtlr",["$scope","$http",function(e,t){t.get("/cluster/list").success(function(n,r,o,s){function a(n){t.get("//"+e.servers[n].host+":"+e.servers[n].port+"/system/stats?type=simple").success(function(t,r,o,s){e.servers[n].online=t.online,e.servers[n].freemem=t.freemem}).error(function(e,t,n,r){console.log(e)})}e.servers=[];for(var i=0;i<n.length;i++)e.servers[i]={hostname:n[i].hostname,host:n[i].host,port:n[i].port,isWorker:"hybrid"===n[i].type||"worker"===n[i].type,isWeb:"hybrid"===n[i].type||"web"===n[i].type},a(i)}).error(function(e,t,n,r){console.log(e)})}]),app.controller("ServerManagementCtlr",["$scope","$http",function(e,t){e.pageSize=20,e.currentPage=0,e.terminalResponse="";var n=io("http://"+host+":"+port);e.getStats=function(){t.get("//"+host+":"+port+"/system/stats?type=all").success(function(t,n,r,o){e.server=t,e.server.uptime=new Date(1e3*t.uptime),e.loadAvg()}).error(function(e,t,n,r){console.log(e)})},e.getPlatformClass=function(e){return"linux"==e?"fa fa-linux":"windows"==e?"fa fa-windows":"apple"==e?"fa fa-wheelchair":void 0},e.loadAvg=function(){var t=["-webkit-transform","-ms-transform"];for(var n in e.server.loadavg){var r=Math.floor(e.server.loadavg[n]/e.server.cpu.length*180),o=2*r;for(var s in t)$("#circle-"+n+" .fill, #circle-"+n+" .mask.full").css(t[s],"rotate("+r+"deg)"),$("#circle-"+n+" .fill.fix").css(t[s],"rotate("+o+"deg)")}},e.getPkgs=function(){t.get("//"+host+":"+port+"/worker/packages/list").success(function(t,n,r,o){e.pkgs=t}).error(function(t,n,r,o){e.pkgs=t})},e.getPkgManagers=function(){t.get("//"+host+":"+port+"/worker/packages/listManagers").success(function(t,n,r,o){e.managers=t}).error(function(t,n,r,o){e.managers=t})},e.getPkgInfo=function(n){t.get("//"+host+":"+port+"/worker/packages/getInfo/"+n).success(function(t,n,r,o){e.pkg=t}).error(function(t,n,r,o){e.pkg=t})},e.installPkg=function(){n.emit("install package",{manager:e.pkgMngr,pkg:e.pkgInstallQuery})},e.updatePkg=function(){n.emit("update package",{manager:e.pkgMngr,pkg:e.pkgUpdateQuery})},n.on("stdout",function(t){e.terminalResponse+=t,console.log("STDOUT:  "+t),e.$apply()}),n.on("stderr",function(t){e.terminalResponse+=t,console.log("STDERR:  "+t),e.$apply()}),n.on("error",function(t){e.terminalResponse+=t,console.log("ERROR:  "+t),e.$apply()}),e.sendInput=function(){e.terminalResponse+="\n",n.emit("input",{input:e.terminalInput}),e.terminalInput=""}}]),app.filter("bytes",function(){return function(e,t){if(isNaN(parseFloat(e))||!isFinite(e))return"-";"undefined"==typeof t&&(t=1);var n=["bytes","KB","MB","GB","TB","PB"],r=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(r))).toFixed(t)+" "+n[r]}}),app.filter("offsetBy",function(){return function(e,t){return t=+t,e.slice(t)}});