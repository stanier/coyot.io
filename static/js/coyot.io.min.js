toastr.options.newestOnTop=!1,toastr.options.progressBar=!1,toastr.options.positionClass="toast-bottom-right",$.material.init(),$.material.ripples(),$.material.input(),$.material.checkbox(),$.material.radio();var app=angular.module("coyot.io",[]);app.controller("ClusterCtlr",["$scope","$http",function(e,t){e.getServers=function(){t.get("/api/cluster/servers").success(function(t,r,s,o){e.servers=[];for(var n=0;n<t.length;n++)e.servers[n]={hostname:t[n].hostname,host:t[n].host,port:t[n].port,isWorker:"hybrid"===t[n].type||"worker"===t[n].type,isWeb:"hybrid"===t[n].type||"web"===t[n].type},e.getStats(n);e.$apply()}).error(function(e,t,r,s){console.log(e)})},e.getStats=function(r){t.get("//"+e.servers[r].host+":"+e.servers[r].port+"/api/system/stats?type=simple").success(function(t,s,o,n){e.servers[r].online=t.online,e.servers[r].freemem=t.freemem}).error(function(e,t,r,s){console.log(e)})}}]),app.controller("ManagementCtlr",["$scope","$http",function(e,t){e.pageSize=20,e.currentPage=0,e.getUsers=function(){t.get("/api/management/users").success(function(t,r,s,o){e.users=t,e.$apply()}).error(function(t,r,s,o){e.users=t,e.$apply()})}}]),app.controller("ServerCtlr",["$scope","$http",function(e,t){e.pageSize=20,e.currentPage=0,e.terminalResponse="",e.serviceStatus=[];var r=io("http://"+host+":"+port);e.getStats=function(){t.get("//"+host+":"+port+"/api/system/stats?type=all").success(function(t,r,s,o){e.server=t,e.server.uptime=new Date(1e3*t.uptime),e.loadAvg()}).error(function(e,t,r,s){console.log(e)})},e.getPlatformClass=function(e){return"linux"==e?"fa fa-linux":"windows"==e?"fa fa-windows":"apple"==e?"fa fa-wheelchair":void 0},e.loadAvg=function(){var t=["-webkit-transform","-ms-transform"];for(var r in e.server.loadavg){var s=Math.floor(e.server.loadavg[r]/e.server.cpu.length*180),o=2*s;for(var n in t)$("#circle-"+r+" .fill, #circle-"+r+" .mask.full").css(t[n],"rotate("+s+"deg)"),$("#circle-"+r+" .fill.fix").css(t[n],"rotate("+o+"deg)")}},e.getPkgs=function(){t.get("//"+host+":"+port+"/api/worker/packages/list").success(function(t,r,s,o){e.pkgs=t}).error(function(t,r,s,o){e.pkgs=t})},e.getPkgManagers=function(){t.get("//"+host+":"+port+"/api/worker/packages/listManagers").success(function(t,r,s,o){e.managers=t}).error(function(t,r,s,o){e.managers=t})},e.getPkgInfo=function(r){t.get("//"+host+":"+port+"/api/worker/packages/getInfo/"+r).success(function(t,r,s,o){e.pkg=t}).error(function(t,r,s,o){e.pkg=t})},e.installPkg=function(){r.emit("install package",{manager:e.pkgMngr,pkg:e.pkgInstallQuery})},e.updatePkg=function(){r.emit("update package",{manager:e.pkgMngr,pkg:e.pkgUpdateQuery})},e.getServiceStatus=function(e){r.emit("get service status",e)},e.getServiceInfo=function(r){t.get("//"+host+":"+port+"/api/worker/services/getInfo/"+r).success(function(t,r,s,o){e.service=t,e.$apply()}).error(function(t,r,s,o){e.service=t,e.$apply()})},e.getRunningServices=function(){r.emit("get status all")},e.startService=function(e){toastr.info("Starting service "+e+"..."),r.emit("start service",e)},e.stopService=function(e){toastr.info("Stopping service "+e+"..."),r.emit("stop service",e)},e.restartService=function(e){toastr.info("Restarting service "+e+"..."),r.emit("restart service",e)},e.sendInput=function(){e.terminalResponse+="\n",r.emit("input",{input:e.terminalInput}),e.terminalInput=""},r.on("start service response",function(t,r){"success"==r&&toastr.success(t+" started successfully"),"failure"==r&&toarts.error(t+" could not be started"),e.service&&e.getServiceInfo(t),e.serviceStatus&&e.getServiceStatus(t)}),r.on("stop service response",function(t,r){"success"==r&&toastr.success(t+" stopped successfully"),"failure"==r&&toastr.error(t+" could not be stopped"),e.service&&e.getServiceInfo(t),e.serviceStatus&&e.getServiceStatus(t)}),r.on("restart service response",function(t,r){"success"==r&&toastr.success(t+" restarted successfully"),"failure"==r&&toastr.error(t+" could not be restarted"),e.service&&e.getServiceInfo(t),e.serviceStatus&&e.getServiceStatus(t)}),r.on("password required",function(e,t){toastr.warning("Password required to "+e+" with user "+t),swal({title:"Password required",text:"A password is required to complete this operation",type:"input",inputType:"password",showCancelButton:!0,closeOnConfirm:!0,animation:"slide-from-top",inputPlaceholder:"Password"},function(e){return e===!1?!1:""===e?(swal.showInputError("Password is required"),!1):void r.emit("password supplied",e)})}),r.on("stdout",function(t){e.terminalResponse+=t,console.log("STDOUT:  "+t),e.$apply()}),r.on("stderr",function(t){e.terminalResponse+=t,console.log("STDERR:  "+t),e.$apply()}),r.on("error",function(e){toastr.error("data")}),r.on("service status response",function(t,r){for(var s=0;s<e.serviceStatus.length;s++)e.serviceStatus[s].service==t&&(e.serviceStatus[s].isRunning=r);e.$apply()}),r.on("service status all response",function(t,r){e.serviceStatus.push({service:t,isRunning:r}),e.$apply()})}]),app.filter("bytes",function(){return function(e,t){if(isNaN(parseFloat(e))||!isFinite(e))return"-";"undefined"==typeof t&&(t=1);var r=["bytes","KB","MB","GB","TB","PB"],s=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(s))).toFixed(t)+" "+r[s]}}),app.filter("offsetBy",function(){return function(e,t){return t=+t,e.slice(t)}});